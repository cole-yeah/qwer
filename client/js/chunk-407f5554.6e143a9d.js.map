{"version":3,"sources":["webpack:///./src/views/canvas/imageNode/index.vue","webpack:///./src/views/canvas/imageNode/utils.js","webpack:///./src/views/canvas/imageNode/index.vue?33c7","webpack:///./src/views/canvas/imageNode/index.vue?2572"],"names":["id","Nodes","density","drawDistance","baseRadius","maxLineThickness","reactionSensitivity","lineThickness","points","mouse","x","y","down","animation","canvas","context","imageInput","bgImage","bgCanvas","bgContext","bgContextPixelData","init","this","document","getElementById","getContext","globalCompositeOperation","width","window","innerWidth","height","innerHeight","style","display","createElement","setAttribute","visibility","addEventListener","upload","body","appendChild","mouseMove","mouseDown","mouseUp","mouseOut","onresize","onWindowResize","loadData","preparePoints","i","j","colors","data","pixelPosition","color","push","originalX","originalY","updatePoints","currentPoint","theta","distance","length","Math","atan2","sqrt","cos","sin","drawLines","otherPoint","fillStyle","strokeStyle","lineWidth","beginPath","moveTo","lineTo","stroke","drawPoints","arc","PI","closePath","fill","draw","requestAnimationFrame","clear","Image","crossOrigin","src","onload","drawImageToBackground","newWidth","newHeight","maxRatio","max","drawImage","getImageData","event","offsetX","layerX","offsetLeft","offsetY","layerY","offsetTop","cancelAnimationFrame","name","render","__scopeId"],"mappings":"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","file":"js/chunk-407f5554.6e143a9d.js","sourcesContent":["<template>\r\n  <canvas id=\"canvas\"></canvas>\r\n  <!-- <img\r\n    class=\"img\"\r\n    src=\"https://pic1.zhimg.com/80/v2-3b1906c98643f07605dbb66412af76b8_720w.png\"\r\n  /> -->\r\n</template>\r\n<script>\r\nimport { Nodes } from \"./utils\";\r\nexport default {\r\n  name: \"ImageNode\",\r\n  mounted() {\r\n    Nodes.init();\r\n  }\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.img {\r\n  width: 100px;\r\n  height: 100px;\r\n}\r\n</style>\r\n","export const Nodes = {\r\n  // Settings\r\n  density: 16,\r\n\r\n  drawDistance: 24,\r\n  baseRadius: 4,\r\n  maxLineThickness: 4,\r\n  reactionSensitivity: 3,\r\n  lineThickness: 1,\r\n\r\n  points: [],\r\n  mouse: { x: -1000, y: -1000, down: false },\r\n\r\n  animation: null,\r\n\r\n  canvas: null,\r\n  context: null,\r\n\r\n  imageInput: null,\r\n  bgImage: null,\r\n  bgCanvas: null,\r\n  bgContext: null,\r\n  bgContextPixelData: null,\r\n\r\n  init: function() {\r\n    // Set up the visual canvas\r\n    this.canvas = document.getElementById(\"canvas\");\r\n    this.context = this.canvas.getContext(\"2d\");\r\n    this.context.globalCompositeOperation = \"lighter\";\r\n    this.canvas.width = window.innerWidth;\r\n    this.canvas.height = window.innerHeight;\r\n    this.canvas.style.display = \"block\";\r\n\r\n    this.imageInput = document.createElement(\"input\");\r\n    this.imageInput.setAttribute(\"type\", \"file\");\r\n    this.imageInput.style.visibility = \"hidden\";\r\n    this.imageInput.addEventListener(\"change\", this.upload, false);\r\n    document.body.appendChild(this.imageInput);\r\n\r\n    this.canvas.addEventListener(\"mousemove\", this.mouseMove, false);\r\n    this.canvas.addEventListener(\"mousedown\", this.mouseDown, false);\r\n    this.canvas.addEventListener(\"mouseup\", this.mouseUp, false);\r\n    this.canvas.addEventListener(\"mouseout\", this.mouseOut, false);\r\n\r\n    window.onresize = function() {\r\n      Nodes.canvas.width = window.innerWidth;\r\n      Nodes.canvas.height = window.innerHeight;\r\n      Nodes.onWindowResize();\r\n    };\r\n\r\n    // Load initial input image (the chrome logo!)\r\n    this.loadData(\r\n      \"https://pic1.zhimg.com/80/v2-3b1906c98643f07605dbb66412af76b8_720w.png\"\r\n    );\r\n  },\r\n\r\n  preparePoints: function() {\r\n    // Clear the current points\r\n    this.points = [];\r\n\r\n    var i, j;\r\n\r\n    var colors = this.bgContextPixelData.data;\r\n\r\n    for (i = 0; i < this.canvas.height; i += this.density) {\r\n      for (j = 0; j < this.canvas.width; j += this.density) {\r\n        var pixelPosition = (j + i * this.bgContextPixelData.width) * 4;\r\n\r\n        // Dont use whiteish pixels\r\n        if (\r\n          (colors[pixelPosition] > 200 &&\r\n            colors[pixelPosition + 1] > 200 &&\r\n            colors[pixelPosition + 2] > 200) ||\r\n          colors[pixelPosition + 3] === 0\r\n        ) {\r\n          continue;\r\n        }\r\n\r\n        var color =\r\n          \"rgba(\" +\r\n          colors[pixelPosition] +\r\n          \",\" +\r\n          colors[pixelPosition + 1] +\r\n          \",\" +\r\n          colors[pixelPosition + 2] +\r\n          \",\" +\r\n          \"1)\";\r\n        this.points.push({\r\n          x: j,\r\n          y: i,\r\n          originalX: j,\r\n          originalY: i,\r\n          color: color\r\n        });\r\n      }\r\n    }\r\n  },\r\n\r\n  updatePoints: function() {\r\n    var i, currentPoint, theta, distance;\r\n\r\n    for (i = 0; i < this.points.length; i++) {\r\n      currentPoint = this.points[i];\r\n\r\n      theta = Math.atan2(\r\n        currentPoint.y - this.mouse.y,\r\n        currentPoint.x - this.mouse.x\r\n      );\r\n\r\n      if (this.mouse.down) {\r\n        distance =\r\n          (this.reactionSensitivity * 200) /\r\n          Math.sqrt(\r\n            (this.mouse.x - currentPoint.x) * (this.mouse.x - currentPoint.x) +\r\n              (this.mouse.y - currentPoint.y) * (this.mouse.y - currentPoint.y)\r\n          );\r\n      } else {\r\n        distance =\r\n          (this.reactionSensitivity * 100) /\r\n          Math.sqrt(\r\n            (this.mouse.x - currentPoint.x) * (this.mouse.x - currentPoint.x) +\r\n              (this.mouse.y - currentPoint.y) * (this.mouse.y - currentPoint.y)\r\n          );\r\n      }\r\n\r\n      currentPoint.x +=\r\n        Math.cos(theta) * distance +\r\n        (currentPoint.originalX - currentPoint.x) * 0.05;\r\n      currentPoint.y +=\r\n        Math.sin(theta) * distance +\r\n        (currentPoint.originalY - currentPoint.y) * 0.05;\r\n    }\r\n  },\r\n\r\n  drawLines: function() {\r\n    var i, j, currentPoint, otherPoint, distance;\r\n\r\n    for (i = 0; i < this.points.length; i++) {\r\n      currentPoint = this.points[i];\r\n\r\n      // Draw the dot.\r\n      this.context.fillStyle = currentPoint.color;\r\n      this.context.strokeStyle = currentPoint.color;\r\n\r\n      for (j = 0; j < this.points.length; j++) {\r\n        // Distaqnce between two points.\r\n        otherPoint = this.points[j];\r\n\r\n        if (otherPoint == currentPoint) {\r\n          continue;\r\n        }\r\n\r\n        distance = Math.sqrt(\r\n          (otherPoint.x - currentPoint.x) * (otherPoint.x - currentPoint.x) +\r\n            (otherPoint.y - currentPoint.y) * (otherPoint.y - currentPoint.y)\r\n        );\r\n\r\n        if (distance <= this.drawDistance) {\r\n          this.context.lineWidth =\r\n            (1 - distance / this.drawDistance) *\r\n            this.maxLineThickness *\r\n            this.lineThickness;\r\n          this.context.beginPath();\r\n          this.context.moveTo(currentPoint.x, currentPoint.y);\r\n          this.context.lineTo(otherPoint.x, otherPoint.y);\r\n          this.context.stroke();\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  drawPoints: function() {\r\n    var i, currentPoint;\r\n\r\n    for (i = 0; i < this.points.length; i++) {\r\n      currentPoint = this.points[i];\r\n\r\n      // Draw the dot.\r\n      this.context.fillStyle = currentPoint.color;\r\n      this.context.strokeStyle = currentPoint.color;\r\n\r\n      this.context.beginPath();\r\n      this.context.arc(\r\n        currentPoint.x,\r\n        currentPoint.y,\r\n        this.baseRadius,\r\n        0,\r\n        Math.PI * 2,\r\n        true\r\n      );\r\n      this.context.closePath();\r\n      this.context.fill();\r\n    }\r\n  },\r\n\r\n  draw: function() {\r\n    this.animation = requestAnimationFrame(function() {\r\n      Nodes.draw();\r\n    });\r\n\r\n    this.clear();\r\n    this.updatePoints();\r\n    this.drawLines();\r\n    this.drawPoints();\r\n  },\r\n\r\n  clear: function() {\r\n    // eslint-disable-next-line no-self-assign\r\n    this.canvas.width = this.canvas.width;\r\n  },\r\n\r\n  // The filereader has loaded the image... add it to image object to be drawn\r\n  loadData: function(data) {\r\n    this.bgImage = new Image();\r\n    this.bgImage.crossOrigin = \"\";\r\n    this.bgImage.src = data;\r\n\r\n    this.bgImage.onload = function() {\r\n      //this\r\n      Nodes.drawImageToBackground();\r\n    };\r\n  },\r\n\r\n  // Image is loaded... draw to bg canvas\r\n  drawImageToBackground: function() {\r\n    this.bgCanvas = document.createElement(\"canvas\");\r\n    this.bgCanvas.width = this.canvas.width;\r\n    this.bgCanvas.height = this.canvas.height;\r\n\r\n    var newWidth, newHeight;\r\n\r\n    // If the image is too big for the screen... scale it down.\r\n    if (\r\n      this.bgImage.width > this.bgCanvas.width - 100 ||\r\n      this.bgImage.height > this.bgCanvas.height - 100\r\n    ) {\r\n      var maxRatio = Math.max(\r\n        this.bgImage.width / (this.bgCanvas.width - 100),\r\n        this.bgImage.height / (this.bgCanvas.height - 100)\r\n      );\r\n      newWidth = this.bgImage.width / maxRatio;\r\n      newHeight = this.bgImage.height / maxRatio;\r\n    } else {\r\n      newWidth = this.bgImage.width;\r\n      newHeight = this.bgImage.height;\r\n    }\r\n\r\n    // Draw to background canvas\r\n    this.bgContext = this.bgCanvas.getContext(\"2d\");\r\n    this.bgContext.drawImage(\r\n      this.bgImage,\r\n      (this.canvas.width - newWidth) / 2,\r\n      (this.canvas.height - newHeight) / 2,\r\n      newWidth,\r\n      newHeight\r\n    );\r\n    this.bgContextPixelData = this.bgContext.getImageData(\r\n      0,\r\n      0,\r\n      this.bgCanvas.width,\r\n      this.bgCanvas.height\r\n    );\r\n\r\n    this.preparePoints();\r\n    this.draw();\r\n  },\r\n\r\n  mouseDown: function() {\r\n    Nodes.mouse.down = true;\r\n  },\r\n\r\n  mouseUp: function() {\r\n    Nodes.mouse.down = false;\r\n  },\r\n\r\n  mouseMove: function(event) {\r\n    Nodes.mouse.x = event.offsetX || event.layerX - Nodes.canvas.offsetLeft;\r\n    Nodes.mouse.y = event.offsetY || event.layerY - Nodes.canvas.offsetTop;\r\n  },\r\n\r\n  mouseOut: function() {\r\n    Nodes.mouse.x = -1000;\r\n    Nodes.mouse.y = -1000;\r\n    Nodes.mouse.down = false;\r\n  },\r\n\r\n  // Resize and redraw the canvas.\r\n  onWindowResize: function() {\r\n    cancelAnimationFrame(this.animation);\r\n    this.drawImageToBackground();\r\n  }\r\n};\r\n","import { render } from \"./index.vue?vue&type=template&id=692e76c4&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=692e76c4&lang=less&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-692e76c4\"\n\nexport default script","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./index.vue?vue&type=style&index=0&id=692e76c4&lang=less&scoped=true\""],"sourceRoot":""}